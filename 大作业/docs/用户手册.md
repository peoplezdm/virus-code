# 系统用户手册（YARA + Sigma 扫描器）

## 1. 概述

本系统为命令行扫描工具：
- 使用 YARA 对文件/目录进行静态检测
- 使用 Sigma 对日志事件（JSON/JSONL）进行规则匹配
- 生成扫描报告 JSON，支持输出评测指标（准确率、误报率、漏报率等）

## 2. 运行环境

- Kali / Linux
- Python 3.10+

## 3. 安装

```bash
cd /path/to/大作业/backend
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

## 4. 使用

### 4.1 YARA 文件扫描

```bash
python -m avscan scan-files --target "/path/to/samples" --out "../out/scan_files.json"
```

### 4.2 Sigma 日志扫描

准备事件文件：
- `.jsonl`：每行一个 JSON 对象（推荐）
- `.json`：单条事件或事件数组

```bash
python -m avscan scan-logs --events "/path/to/events.jsonl" --out "../out/scan_logs.json"
```

### 4.3 指标评测

真值文件 `truth.csv` 需要两列：
- `key`：文件绝对路径（对应 scan-files 输出中的 `findings[].file`）或事件索引（对应 scan-logs 输出中的 `findings[].event_index`）
- `label`：1=恶意，0=良性

```bash
python -m avscan evaluate --truth "../docs/truth.csv" --scan-json "../out/scan_files.json" --out "../out/metrics.json"
```
